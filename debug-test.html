<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Debug Test</title>
    <script src="js/task-variant-generator.js"></script>
</head>
<body>
    <h1>Debug Test Generatora</h1>
    <pre id="log"></pre>
    
    <script>
        const log = (msg) => {
            document.getElementById('log').textContent += msg + '\n';
            console.log(msg);
        };
        
        async function test() {
            log('=== START TESTU ===');
            
            const generator = new TaskVariantGenerator();
            log('Generator utworzony');
            log('Proxy endpoint: ' + generator.proxyEndpoint);
            log('Session token: ' + (generator.sessionToken || 'BRAK'));
            
            // Autoryzacja
            log('\n--- AUTORYZACJA ---');
            try {
                const authResult = await generator.authenticate('debug_user', 'teacher');
                log('Autoryzacja: ' + (authResult ? 'SUKCES' : 'PORAŻKA'));
                log('Nowy token: ' + (generator.sessionToken || 'BRAK'));
            } catch (e) {
                log('BŁĄD autoryzacji: ' + e.message);
                return;
            }
            
            // Test zadania
            const testTask = {
                id: 'debug_1',
                tresc: 'Oblicz pole kwadratu o boku 4 cm.',
                typ: 'zamkniete',
                odpowiedzi: ['16 cm²', '8 cm²', '12 cm²', '20 cm²'],
                poprawna: '16 cm²',
                przedmiot: 'Matematyka',
                temat: 'Geometria podstawowa',
                poziom: 'podstawowy',
                punkty: 1
            };
            
            // Sprawdź możliwość generacji
            log('\n--- ANALIZA ZADANIA ---');
            const canGen = generator.canGenerateVariant(testTask);
            log('Może generować: ' + canGen.canGenerate);
            log('Wymaga AI: ' + canGen.requiresAI);
            log('Szacowany koszt: $' + canGen.estimatedCost);
            
            // Generuj wariant
            log('\n--- GENERACJA WARIANTU ---');
            try {
                const result = await generator.generateVariant(testTask, { useAI: true });
                log('Wynik generacji:');
                log(JSON.stringify(result, null, 2));
                
                if (result.success) {
                    log('\nWygenerowany wariant:');
                    log('Treść: ' + result.variant.tresc);
                    log('Poprawna: ' + result.variant.poprawna);
                    log('Odpowiedzi: ' + result.variant.odpowiedzi.join(', '));
                }
            } catch (e) {
                log('BŁĄD generacji: ' + e.message);
                log('Stack: ' + e.stack);
            }
            
            log('\n=== KONIEC TESTU ===');
        }
        
        // Uruchom test po załadowaniu
        window.onload = () => {
            test().catch(e => log('KRYTYCZNY BŁĄD: ' + e.message));
        };
    </script>
</body>
</html>