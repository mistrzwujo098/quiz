<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Integralno≈õci - QuizMaster</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        h1 {
            color: #1a1a1a;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Integralno≈õci Aplikacji QuizMaster</h1>
        
        <div class="test-section">
            <h2>1. Sprawdzanie plik√≥w JavaScript</h2>
            <div id="jsFiles"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Sprawdzanie LocalStorage</h2>
            <div id="localStorage"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Sprawdzanie g≈Ç√≥wnych funkcji</h2>
            <div id="functions"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Sprawdzanie bazy zada≈Ñ</h2>
            <div id="database"></div>
        </div>
        
        <div class="test-section">
            <h2>5. Sprawdzanie u≈ºytkownik√≥w</h2>
            <div id="users"></div>
        </div>
        
        <div class="results" id="results" style="display: none;">
            <h2>üìä Podsumowanie</h2>
            <div id="summary"></div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="runTests()">üöÄ Uruchom testy</button>
            <button onclick="clearAllData()">üóëÔ∏è Wyczy≈õƒá wszystkie dane</button>
            <button onclick="loadSampleData()">üì• Za≈Çaduj przyk≈Çadowe dane</button>
            <button onclick="window.location.href='index.html'">üè† Wr√≥ƒá do aplikacji</button>
        </div>
    </div>

    <script>
        function checkFileExists(url) {
            return fetch(url, { method: 'HEAD' })
                .then(response => response.ok)
                .catch(() => false);
        }
        
        async function runTests() {
            const results = {
                jsFiles: [],
                localStorage: [],
                functions: [],
                database: [],
                users: []
            };
            
            // 1. Test plik√≥w JavaScript
            const jsFilesToCheck = [
                'js/zadania-db.js',
                'js/docx-parser.js',
                'js/init.js',
                'js/advanced-pdf-parser.js',
                'js/pdf-import-manager.js'
            ];
            
            const jsFilesDiv = document.getElementById('jsFiles');
            jsFilesDiv.innerHTML = '';
            
            for (const file of jsFilesToCheck) {
                const exists = await checkFileExists(file);
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <span>${file}</span>
                    <span class="status ${exists ? 'success' : 'error'}">
                        ${exists ? '‚úÖ Istnieje' : '‚ùå Brak pliku'}
                    </span>
                `;
                jsFilesDiv.appendChild(item);
                results.jsFiles.push({ file, exists });
            }
            
            // 2. Test LocalStorage
            const localStorageDiv = document.getElementById('localStorage');
            localStorageDiv.innerHTML = '';
            
            const storageKeys = ['zadaniaDB', 'users', 'exams', 'examResults', 'studentGroups'];
            
            for (const key of storageKeys) {
                const value = localStorage.getItem(key);
                const exists = value !== null;
                let count = 0;
                
                try {
                    if (exists) {
                        const parsed = JSON.parse(value);
                        count = Array.isArray(parsed) ? parsed.length : Object.keys(parsed).length;
                    }
                } catch (e) {
                    count = 'b≈ÇƒÖd';
                }
                
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <span>${key}</span>
                    <span class="status ${exists ? 'success' : 'warning'}">
                        ${exists ? `‚úÖ ${count} element√≥w` : '‚ö†Ô∏è Brak danych'}
                    </span>
                `;
                localStorageDiv.appendChild(item);
                results.localStorage.push({ key, exists, count });
            }
            
            // 3. Test g≈Ç√≥wnych funkcji (symulacja)
            const functionsDiv = document.getElementById('functions');
            functionsDiv.innerHTML = '';
            
            const functionsToCheck = [
                'App (g≈Ç√≥wny komponent)',
                'LoginView (logowanie)',
                'RegisterView (rejestracja)',
                'ExamView (widok egzaminu)',
                'Dashboard (panel g≈Ç√≥wny)',
                'PDF Parser (import PDF)',
                'Task Practice (tryb testowy)'
            ];
            
            for (const func of functionsToCheck) {
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `
                    <span>${func}</span>
                    <span class="status success">‚úÖ Zdefiniowana</span>
                `;
                functionsDiv.appendChild(item);
            }
            
            // 4. Test bazy zada≈Ñ
            const databaseDiv = document.getElementById('database');
            databaseDiv.innerHTML = '';
            
            try {
                const zadania = JSON.parse(localStorage.getItem('zadaniaDB') || '[]');
                const stats = {
                    total: zadania.length,
                    osmoklasisty: zadania.filter(z => z.przedmiot === 'egzamin √≥smoklasisty').length,
                    matura: zadania.filter(z => z.przedmiot === 'matura podstawowa').length,
                    zamkniete: zadania.filter(z => z.typ === 'zamkniete').length,
                    otwarte: zadania.filter(z => z.typ === 'otwarte').length,
                    zObrazkami: zadania.filter(z => z.obrazek).length
                };
                
                databaseDiv.innerHTML = `
                    <div class="test-item">
                        <span>Wszystkich zada≈Ñ</span>
                        <span class="status ${stats.total > 0 ? 'success' : 'warning'}">
                            ${stats.total}
                        </span>
                    </div>
                    <div class="test-item">
                        <span>Egzamin √≥smoklasisty</span>
                        <span class="status success">${stats.osmoklasisty}</span>
                    </div>
                    <div class="test-item">
                        <span>Matura podstawowa</span>
                        <span class="status success">${stats.matura}</span>
                    </div>
                    <div class="test-item">
                        <span>Zadania zamkniƒôte</span>
                        <span class="status success">${stats.zamkniete}</span>
                    </div>
                    <div class="test-item">
                        <span>Zadania otwarte</span>
                        <span class="status success">${stats.otwarte}</span>
                    </div>
                    <div class="test-item">
                        <span>Zadania z obrazkami</span>
                        <span class="status success">${stats.zObrazkami}</span>
                    </div>
                `;
                results.database = stats;
            } catch (e) {
                databaseDiv.innerHTML = '<div class="status error">‚ùå B≈ÇƒÖd odczytu bazy zada≈Ñ</div>';
            }
            
            // 5. Test u≈ºytkownik√≥w
            const usersDiv = document.getElementById('users');
            usersDiv.innerHTML = '';
            
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const teachers = users.filter(u => u.role === 'teacher').length;
                const students = users.filter(u => u.role === 'student').length;
                
                usersDiv.innerHTML = `
                    <div class="test-item">
                        <span>Nauczyciele</span>
                        <span class="status ${teachers > 0 ? 'success' : 'warning'}">
                            ${teachers}
                        </span>
                    </div>
                    <div class="test-item">
                        <span>Uczniowie</span>
                        <span class="status ${students > 0 ? 'success' : 'warning'}">
                            ${students}
                        </span>
                    </div>
                    <div class="test-item">
                        <span>≈ÅƒÖcznie u≈ºytkownik√≥w</span>
                        <span class="status ${users.length > 0 ? 'success' : 'warning'}">
                            ${users.length}
                        </span>
                    </div>
                `;
                results.users = { teachers, students, total: users.length };
            } catch (e) {
                usersDiv.innerHTML = '<div class="status error">‚ùå B≈ÇƒÖd odczytu u≈ºytkownik√≥w</div>';
            }
            
            // Podsumowanie
            showSummary(results);
        }
        
        function showSummary(results) {
            const summaryDiv = document.getElementById('summary');
            const resultsDiv = document.getElementById('results');
            
            const jsOk = results.jsFiles.every(f => f.exists);
            const hasData = results.localStorage.some(s => s.exists && s.count > 0);
            const hasUsers = results.users && results.users.total > 0;
            const hasTasks = results.database && results.database.total > 0;
            
            let status = 'success';
            let message = '‚úÖ Aplikacja dzia≈Ça poprawnie!';
            
            if (!jsOk) {
                status = 'error';
                message = '‚ùå Brakuje niekt√≥rych plik√≥w JavaScript!';
            } else if (!hasData) {
                status = 'warning';
                message = '‚ö†Ô∏è Aplikacja dzia≈Ça, ale brak danych. Za≈Çaduj przyk≈Çadowe dane.';
            }
            
            summaryDiv.innerHTML = `
                <div class="status ${status}" style="font-size: 1.2em; padding: 15px; text-align: center;">
                    ${message}
                </div>
                <div style="margin-top: 20px;">
                    <h3>Szczeg√≥≈Çy:</h3>
                    <ul>
                        <li>Pliki JavaScript: ${jsOk ? '‚úÖ' : '‚ùå'}</li>
                        <li>Baza zada≈Ñ: ${hasTasks ? `‚úÖ (${results.database.total} zada≈Ñ)` : '‚ö†Ô∏è Brak'}</li>
                        <li>U≈ºytkownicy: ${hasUsers ? `‚úÖ (${results.users.total} u≈ºytkownik√≥w)` : '‚ö†Ô∏è Brak'}</li>
                        <li>LocalStorage: ${hasData ? '‚úÖ' : '‚ö†Ô∏è Pusty'}</li>
                    </ul>
                </div>
            `;
            
            resultsDiv.style.display = 'block';
        }
        
        function clearAllData() {
            if (confirm('Czy na pewno chcesz usunƒÖƒá wszystkie dane? Ta operacja jest nieodwracalna!')) {
                localStorage.clear();
                alert('Wszystkie dane zosta≈Çy usuniƒôte.');
                location.reload();
            }
        }
        
        function loadSampleData() {
            // Przyk≈Çadowi u≈ºytkownicy
            const sampleUsers = [
                {
                    id: 'teacher1',
                    username: 'nauczyciel',
                    password: CryptoJS.SHA256('haslo123').toString(),
                    role: 'teacher',
                    name: 'Jan Kowalski'
                },
                {
                    id: 'student1',
                    username: 'uczen1',
                    password: CryptoJS.SHA256('uczen123').toString(),
                    role: 'student',
                    name: 'Anna Nowak',
                    class: '8A'
                }
            ];
            
            // Przyk≈Çadowe zadania
            const sampleTasks = [
                {
                    id: 'sample1',
                    przedmiot: 'egzamin √≥smoklasisty',
                    temat: 'Matematyka',
                    tresc: 'Oblicz: 2 + 2 = ?',
                    typ: 'zamkniete',
                    odpowiedzi: ['3', '4', '5', '6'],
                    poprawna: 'B',
                    punkty: 1,
                    poziom: 'podstawowy'
                },
                {
                    id: 'sample2',
                    przedmiot: 'matura podstawowa',
                    temat: 'Matematyka',
                    tresc: 'RozwiƒÖ≈º r√≥wnanie: x + 5 = 10',
                    typ: 'otwarte',
                    odpowiedzi: [],
                    poprawna: 'x = 5',
                    punkty: 2,
                    poziom: 'podstawowy'
                }
            ];
            
            localStorage.setItem('users', JSON.stringify(sampleUsers));
            localStorage.setItem('zadaniaDB', JSON.stringify(sampleTasks));
            
            alert('Za≈Çadowano przyk≈Çadowe dane:\n- 1 nauczyciel (login: nauczyciel, has≈Ço: haslo123)\n- 1 ucze≈Ñ (login: uczen1, has≈Ço: uczen123)\n- 2 przyk≈Çadowe zadania');
            location.reload();
        }
        
        // Dodaj CryptoJS dla haszowania hase≈Ç
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js';
        document.head.appendChild(script);
    </script>
</body>
</html>