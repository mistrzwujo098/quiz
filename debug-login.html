<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Debug logowania</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <h1>Debugowanie systemu logowania</h1>
    <button onclick="checkUsers()">Sprawdź użytkowników</button>
    <button onclick="addTeacher()">Dodaj nauczyciela paulinaodmatematyki</button>
    <button onclick="testLogin()">Test logowania</button>
    
    <div id="result"></div>
    
    <script>
        function checkUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            let html = '<h2>Wszyscy użytkownicy:</h2><ul>';
            
            users.forEach(user => {
                html += `<li>
                    <strong>${user.username}</strong> - 
                    Role: ${user.role}, 
                    ID: ${user.id || user.userId}, 
                    Has password: ${!!user.password}
                </li>`;
            });
            
            html += '</ul>';
            
            // Znajdź paulinaodmatematyki
            const paulina = users.find(u => u.username === 'paulinaodmatematyki');
            if (paulina) {
                html += '<h3>Znaleziono paulinaodmatematyki!</h3>';
                html += '<pre>' + JSON.stringify(paulina, null, 2) + '</pre>';
            } else {
                html += '<h3 style="color: red;">NIE znaleziono paulinaodmatematyki!</h3>';
            }
            
            document.getElementById('result').innerHTML = html;
        }
        
        function addTeacher() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            // Usuń istniejącego użytkownika jeśli istnieje
            const filteredUsers = users.filter(u => u.username !== 'paulinaodmatematyki');
            
            // Dodaj nowego użytkownika
            const hashedPassword = CryptoJS.SHA256('paulina#314159265').toString();
            filteredUsers.push({
                id: Date.now(),
                username: 'paulinaodmatematyki',
                password: hashedPassword,
                role: 'teacher',
                createdAt: new Date()
            });
            
            localStorage.setItem('users', JSON.stringify(filteredUsers));
            
            document.getElementById('result').innerHTML = `
                <h2>Dodano nauczyciela!</h2>
                <p>Login: paulinaodmatematyki</p>
                <p>Hasło: paulina#314159265</p>
                <p>Teraz możesz wrócić do <a href="/">strony głównej</a> i zalogować się.</p>
            `;
        }
        
        function testLogin() {
            const username = 'paulinaodmatematyki';
            const password = 'paulina#314159265';
            const hashedPassword = CryptoJS.SHA256(password).toString();
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.username === username);
            
            let html = '<h2>Test logowania:</h2>';
            html += `<p>Szukam użytkownika: ${username}</p>`;
            html += `<p>Hash hasła: ${hashedPassword}</p>`;
            
            if (user) {
                html += '<p style="color: green;">Użytkownik znaleziony!</p>';
                html += `<p>Hash w bazie: ${user.password}</p>`;
                html += `<p>Hasła się ${user.password === hashedPassword ? 'ZGADZAJĄ' : 'NIE ZGADZAJĄ'}</p>`;
            } else {
                html += '<p style="color: red;">Użytkownik NIE znaleziony!</p>';
            }
            
            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>
</html>